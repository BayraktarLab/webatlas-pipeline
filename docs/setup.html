<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Setup &mdash; vitessce-pipeline 0.1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Running" href="run.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            vitessce-pipeline
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#run-parameters">Run parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#args">Args</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vitessce-options">Vitessce options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#data-parameters">Data parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-file">Data file</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#raw-image-data">raw image data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#label-image-data">label image data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dataset-information">Dataset information</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#docker">Docker</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="run.html">Running</a></li>
<li class="toctree-l1"><a class="reference internal" href="run.html#visualizing">Visualizing</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Modules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="demos.html">Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/haniffalab/vitessce-pipeline">Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/haniffalab/vitessce-pipeline/issues">Issue Tracker</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/haniffalab/vitessce-app">Frontend Client</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Teams</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://www.sanger.ac.uk/group/bayraktar-group">Bayraktar Lab</a></li>
<li class="toctree-l1"><a class="reference external" href="https://haniffalab.com">Haniffa Lab</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.openmicroscopy.org/">Open Microscopy Environment</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">vitessce-pipeline</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Setup</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/setup.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="setup">
<span id="id1"></span><h1>Setup<a class="headerlink" href="#setup" title="Permalink to this heading"></a></h1>
<p>Currently, the pipeline can process several types of data files as well as images.
It can handle <code class="docutils literal notranslate"><span class="pre">h5ad</span></code> files, SpaceRanger output, Xenium output, MERSCOPE output, and <code class="docutils literal notranslate"><span class="pre">molecules</span></code> data in <code class="docutils literal notranslate"><span class="pre">csv</span></code>/<code class="docutils literal notranslate"><span class="pre">tsv</span></code> files.
It can handle raw and label images in <code class="docutils literal notranslate"><span class="pre">tif</span></code> format, as well as generating/preprocessing images from Visium, Xenium and MERFISH data.</p>
<p>Running the pipeline requires two parameters files:</p>
<ol class="arabic simple">
<li><p>a <a class="reference internal" href="#id2">run parameters</a> <code class="docutils literal notranslate"><span class="pre">yaml</span></code> file with general configuration options</p></li>
<li><p>a <a class="reference internal" href="#id3">data parameters</a> <code class="docutils literal notranslate"><span class="pre">csv</span></code>/<code class="docutils literal notranslate"><span class="pre">tsv</span></code> file with dataset-specific information</p></li>
</ol>
<p>Templates are available in the <a class="reference external" href="templates/">templates directory</a>.</p>
<section id="run-parameters">
<span id="id2"></span><h2>Run parameters<a class="headerlink" href="#run-parameters" title="Permalink to this heading"></a></h2>
<p>The run parameters file is a <code class="docutils literal notranslate"><span class="pre">yaml</span></code> that defines several configuration options which apply to a full run of the pipeline (which can process one or more datasets).
Parameters for each type of data file work as the default parameters to all the data files defined in the <a class="reference internal" href="#id3">data parameters</a> file.</p>
<p>In the command line, the path to the <code class="docutils literal notranslate"><span class="pre">yaml</span></code> file is indicated through the <code class="docutils literal notranslate"><span class="pre">-params-file</span></code> flag.</p>
<p>A run parameters file can look like:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">data_params</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/path/to/data-parameters.csv&quot;</span>
<span class="nt">outdir</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/path/to/output/&quot;</span>
<span class="nt">args</span><span class="p">:</span>
<span class="w">    </span><span class="nt">h5ad</span><span class="p">:</span>
<span class="w">        </span><span class="nt">compute_embeddings</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;True&quot;</span>
<span class="nt">vitessce_options</span><span class="p">:</span>
<span class="w">    </span><span class="nt">spatial</span><span class="p">:</span>
<span class="w">        </span><span class="nt">xy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;obsm/spatial&quot;</span>
<span class="w">    </span><span class="nt">mappings</span><span class="p">:</span>
<span class="w">        </span><span class="nt">obsm/X_umap</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="nv">1</span><span class="p p-Indicator">]</span>
<span class="nt">layout</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;simple&quot;</span>
</pre></div>
</div>
<p>The parameters are as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data_params</span></code>, the path to the <a class="reference internal" href="#id3">data parameters</a> <code class="docutils literal notranslate"><span class="pre">csv</span></code>/<code class="docutils literal notranslate"><span class="pre">tsv</span></code> file that contains the datasets’ information and data files to process.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_params_delimiter</span></code>, the delimiter to be used for the <a class="reference internal" href="#id3">data parameters</a> file.
Defaults to <code class="docutils literal notranslate"><span class="pre">,</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outdir</span></code>, the path to the directory to which output files will be written.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">args</span></code>, a map of optional arguments for the scripts that process the supported files.
This is applied to files of all datasets. See available <a class="reference internal" href="#args">args</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vitessce_options</span></code>, a map of the contents of a dataset’s Anndata object that gets
converted to Zarr. This is information required to write the Vitessce
config file. These values are applied to all datasets unless a dataset
has its own <code class="docutils literal notranslate"><span class="pre">options</span></code> specified within the <a class="reference internal" href="#id3">data parameters</a> file.
<a class="reference internal" href="#run-parameters-vitessce-options"><span class="std std-ref">See more</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">layout</span></code>, a predefined Vitessce layout to use, it can be either
<code class="docutils literal notranslate"><span class="pre">minimal</span></code>, <code class="docutils literal notranslate"><span class="pre">simple</span></code> or <code class="docutils literal notranslate"><span class="pre">advanced</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">custom_layout</span></code>, an optional string that defines a Vitessce layout
following <a class="reference external" href="https://vitessce.github.io/vitessce-python/api_config.html#vitessce.config.VitessceConfig.layout">Vitessce’s View Config API’s layout alternative
syntax</a>
(Vitessce components are concatenated horizontally with <code class="docutils literal notranslate"><span class="pre">|</span></code> and
vertically with <code class="docutils literal notranslate"><span class="pre">/</span></code>). Supersedes <code class="docutils literal notranslate"><span class="pre">layout</span></code>.</p></li>
</ul>
<section id="args">
<span id="run-parameters-args"></span><h3>Args<a class="headerlink" href="#args" title="Permalink to this heading"></a></h3>
<p>Available <code class="docutils literal notranslate"><span class="pre">args</span></code> depend of the supported data type of each data file.</p>
<p>Supported data types are <code class="docutils literal notranslate"><span class="pre">h5ad</span></code>, <code class="docutils literal notranslate"><span class="pre">spaceranger</span></code>, <code class="docutils literal notranslate"><span class="pre">xenium</span></code>, <code class="docutils literal notranslate"><span class="pre">merscope</span></code>, <code class="docutils literal notranslate"><span class="pre">molecules</span></code></p>
<p>This are passed to the processing script for all the files of the
corresponding data type (unless overriden in the <a class="reference internal" href="#id3">data parameters</a> file).
Possible values for the currently supported data types are as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">args</span><span class="p">:</span>
<span class="w">  </span><span class="nt">h5ad</span><span class="p">:</span>
<span class="w">    </span><span class="nt">compute_embeddings</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;True&quot;</span><span class="w"> </span><span class="c1"># set to `True` to compute PCA and UMAP if not already within the anndata object</span>
<span class="w">    </span><span class="nt">chunk_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span><span class="w"> </span><span class="c1"># Zarr chunk size, defaults to 10</span>
<span class="w">    </span><span class="nt">var_index</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SYMBOL&quot;</span><span class="w"> </span><span class="c1"># `var` column from the anndata object to use as the gene names in the webapp. This reindexes the `var` matrix</span>
<span class="w">    </span><span class="nt">obs_subset</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sample&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sample_id_1&quot;</span><span class="p p-Indicator">]]</span><span class="w"> </span><span class="c1"># optional `obs` column name an value(s) to subset the anndata object</span>
<span class="w">    </span><span class="nt">var_subset</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;genome&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;GRCh38&quot;</span><span class="p p-Indicator">]]</span><span class="w"> </span><span class="c1"># optional `var` column name an value(s) to subset the anndata object</span>
<span class="w">    </span><span class="nt">batch_processing</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;False&quot;</span><span class="w"> </span><span class="c1"># set to `True` to process the file in batches to avoid loading the whole object into memory if it is too large</span>
<span class="w">    </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span><span class="w"> </span><span class="c1"># batch size (number of columns to process at a time if matrix is dense/csc, number of rows if matrix is csr) if `batch_processing` is set to `True`</span>
<span class="w">  </span><span class="nt">spaceranger</span><span class="p">:</span>
<span class="w">    </span><span class="nt">save_h5ad</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;True&quot;</span><span class="w"> </span><span class="c1"># save the intermediate h5ad to the output directory. Defaults to `False`</span>
<span class="w">    </span><span class="nt">load_clusters</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;True&quot;</span><span class="w"> </span><span class="c1"># set to `False` to disable loading the clusters from the `analysis` directory</span>
<span class="w">    </span><span class="nt">load_embeddings</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;True&quot;</span><span class="w"> </span><span class="c1"># set to `False` to disable loading the embeddings (UMAP, tSNE and PCA) from the `analysis` directory</span>
<span class="w">    </span><span class="nt">clustering</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;graphclust&quot;</span><span class="w"> </span><span class="c1"># clusters to load (if `load_clusters` is set to `True`)</span>
<span class="w">  </span><span class="nt">xenium</span><span class="p">:</span>
<span class="w">    </span><span class="nt">save_h5ad</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;True&quot;</span><span class="w"> </span><span class="c1"># save the intermediate h5ad to the output directory. Defaults to `False`</span>
<span class="w">    </span><span class="nt">spatial_as_pixel</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;True&quot;</span><span class="w"> </span><span class="c1"># convert spatial coordinates to pixel coordinates. Defaults to `True`</span>
<span class="w">    </span><span class="nt">resolution</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2125</span><span class="w"> </span><span class="c1"># pixel resolution used to convert the spatial coordinates. Defaults to 0.2125</span>
<span class="w">  </span><span class="nt">merscope</span><span class="p">:</span>
<span class="w">    </span><span class="nt">save_h5ad</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;True&quot;</span><span class="w"> </span><span class="c1"># save the intermediate h5ad to the output directory. Defaults to `False`</span>
<span class="w">    </span><span class="nt">filter_prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Blank-&quot;</span><span class="w"> </span><span class="c1"># prefix to filter out data from the cell by gene data. Defaults to `Blank-`</span>
<span class="w">  </span><span class="nt">molecules</span><span class="p">:</span>
<span class="w">    </span><span class="nt">delimiter</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="w"> </span><span class="c1"># the file delimiter. Defaults to `\t`</span>
<span class="w">    </span><span class="nt">has_header</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;True&quot;</span><span class="w"> </span><span class="c1"># set to `False` if csv/tsv file contains no header</span>
<span class="w">    </span><span class="nt">gene_col_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Name&quot;</span><span class="w"> </span><span class="c1"># name of the column for gene names. Defaults to `Name`.</span>
<span class="w">    </span><span class="nt">x_col_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;x_int&quot;</span><span class="w"> </span><span class="c1"># name of the column for `x` coordinates. Defaults to `x_int`.</span>
<span class="w">    </span><span class="nt">y_col_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;y_int&quot;</span><span class="w"> </span><span class="c1"># name of the column for `y` coordinates. Defaults to `y_int`.</span>
<span class="w">    </span><span class="nt">gene_col_idx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"> </span><span class="c1"># column index of the column for gene names in case `has_header` is `False`.</span>
<span class="w">    </span><span class="nt">x_col_idx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># column index of the column for `x` coordinates in case `has_header` is `False`.</span>
<span class="w">    </span><span class="nt">y_col_idx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"> </span><span class="c1"># column index of the column for `y` coordinates in case `has_header` is `False`.</span>
</pre></div>
</div>
<p>Note that in the case of <code class="docutils literal notranslate"><span class="pre">spaceranger</span></code>, <code class="docutils literal notranslate"><span class="pre">xenium</span></code> and <code class="docutils literal notranslate"><span class="pre">merscope</span></code> data, it initially gets converted
into an <code class="docutils literal notranslate"><span class="pre">h5ad</span></code> file and so when processed the <code class="docutils literal notranslate"><span class="pre">args</span></code> for <code class="docutils literal notranslate"><span class="pre">h5ad</span></code> also apply to it,
unless overriden in the <a class="reference internal" href="#id3">data parameters</a> file.</p>
</section>
<section id="vitessce-options">
<span id="run-parameters-vitessce-options"></span><h3>Vitessce options<a class="headerlink" href="#vitessce-options" title="Permalink to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">vitessce_options</span></code> map is used to write Vitessce config files.
One Vitessce config file is generated per dataset.
Include relevant information from your data to be visualized.
All values are optional as they depend on them existing in your data.</p>
<p>Values that can be specified are <code class="docutils literal notranslate"><span class="pre">spatial</span></code>, <code class="docutils literal notranslate"><span class="pre">mappings</span></code>, <code class="docutils literal notranslate"><span class="pre">factors</span></code>, <code class="docutils literal notranslate"><span class="pre">sets</span></code> and <code class="docutils literal notranslate"><span class="pre">matrix</span></code>,
and should be defined as the following example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">vitessce_options</span><span class="p">:</span>
<span class="w">  </span><span class="nt">spatial</span><span class="p">:</span>
<span class="w">    </span><span class="nt">xy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;obsm/spatial&quot;</span><span class="w"> </span><span class="c1"># where the Anndata object holds spatial coordinates</span>
<span class="w">  </span><span class="nt">mappings</span><span class="p">:</span><span class="w"> </span><span class="c1"># list of embeddings and the index of the dimensions to use in a scatterplot</span>
<span class="w">    </span><span class="nt">obsm/X_umap</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="nv">1</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">obsm/spatial</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="nv">1</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">factors</span><span class="p">:</span><span class="w"> </span><span class="c1"># list of useful metadata to show per cell when hovering over them in the visualization</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;obs/sample&quot;</span>
<span class="w">  </span><span class="nt">sets</span><span class="p">:</span><span class="w"> </span><span class="c1"># list of keys for grouping cells</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;obs/celltype&quot;</span><span class="w"> </span><span class="c1"># key with cell set labels</span>
<span class="w">      </span><span class="nt">score</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;obs/celltype_prob&quot;</span><span class="w"> </span><span class="c1"># key with cell set confidence/percentage scores (float values [0,1])</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;obs/sample&quot;</span><span class="w"> </span><span class="c1"># key with cell set labels, without associated scores</span>
<span class="w">  </span><span class="nt">matrix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;X&quot;</span><span class="w"> </span><span class="c1"># expression matrix to use</span>
</pre></div>
</div>
<p><strong>Note</strong> that the pipeline does not check for the existence of these
metadata within the h5ad file. It is written directly to the Vitessce
config file. If they’re incorrectly specified then an error will occur when
Vitessce tries to load the data. The output config
file can be manually edited without re-running the pipeline to fix or adapt
the visualization to your needs.</p>
</section>
</section>
<section id="data-parameters">
<span id="id3"></span><h2>Data parameters<a class="headerlink" href="#data-parameters" title="Permalink to this heading"></a></h2>
<p>The data parameters file is a <code class="docutils literal notranslate"><span class="pre">csv</span></code>/<code class="docutils literal notranslate"><span class="pre">tsv</span></code> file used to define <a class="reference internal" href="#dataset-information">dataset information</a> and <a class="reference internal" href="#data-parameters-data-file"><span class="std std-ref">data files</span></a> to be processed.
Multiple datasets can be defined in the same data parameters file and they will all be processed in the same pipeline run.
Each line can either define a file/image <em>or</em> dataset information.</p>
<p>For example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>project,dataset,data_type,data_path,args,prefix
project_1,dataset_1,title,Sample dataset,,
project_1,dataset_1,h5ad,/path/to/visium/anndata.h5ad,,
project_1,dataset_1,raw_image,/path/to/raw_image.tif,,
project_1,dataset_1,label_image,/path/to/label_image.tif,,
</pre></div>
</div>
<p>The supported image format is <code class="docutils literal notranslate"><span class="pre">tif</span></code>.
Images can be either raw images (microscopy images) or label images (containing segmentations).
Additionally, label images can be generated and processed if provided with the necessary data.
Label images can be generated for Visium data if provided with an <code class="docutils literal notranslate"><span class="pre">h5ad</span></code> file or
SpaceRanger output directory, and Xenium and MERSCOPE if provided with their
respective output directories.
Raw images can also be pre-processed, in the case of MERSCOPE data where the raw image channels
are stored in separate <code class="docutils literal notranslate"><span class="pre">tif</span></code> files the pipeline can concatenate them to then convert them.</p>
<p>Datasets are identified and grouped by the joint <code class="docutils literal notranslate"><span class="pre">project-dataset</span></code> key.
Each dataset does not need to contain all types of data types,
but it should contain at least one file or image be processed.</p>
<p>Columns definitions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">project</span></code> is the project/experiment name which can have multiple datasets</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dataset</span></code> is the name of the dataset</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_type</span></code> is the type of file to be processed if the line defines a <a class="reference internal" href="#data-file">data file</a>,
or the type of <a class="reference internal" href="#dataset-information">dataset information</a> otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_path</span></code> is the path to file or directory containing the data if the line defines a <a class="reference internal" href="#data-file">data file</a>,
or the <a class="reference internal" href="#dataset-information">dataset information</a> value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">args</span></code> is an optional JSON-like string defining argument names and values
to be used in the script that processes the data file.
It must be written inside simple quotes <code class="docutils literal notranslate"><span class="pre">'</span></code>, with strings inside it using double quotes <code class="docutils literal notranslate"><span class="pre">&quot;</span></code>,
like <code class="docutils literal notranslate"><span class="pre">'{&quot;key&quot;:</span> <span class="pre">&quot;value&quot;}'</span></code>.
This overrides <code class="docutils literal notranslate"><span class="pre">args</span></code> from <a class="reference internal" href="#id2">run parameters</a> for the line’s file only.
This value is not used if the line is defining dataset information.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prefix</span></code> is an optional string to prefix the output filenames, along with the <code class="docutils literal notranslate"><span class="pre">project</span></code>
and <code class="docutils literal notranslate"><span class="pre">dataset</span></code> names, so the output filenames become <code class="docutils literal notranslate"><span class="pre">{project}-{dataset}-{prefix}-file.ext</span></code>.
Required if you have multiple input files of the same <code class="docutils literal notranslate"><span class="pre">data_type</span></code> within the same <code class="docutils literal notranslate"><span class="pre">project</span></code>
and <code class="docutils literal notranslate"><span class="pre">dataset</span></code>, as they would otherwise get
overwritten with the default output filename <code class="docutils literal notranslate"><span class="pre">{project}-{dataset}-file.ext</span></code>.
If a single input file generates multiple output files of the same type, a prefix will
automatically be added to each of them to avoid overwritting.</p></li>
</ul>
<section id="data-file">
<span id="data-parameters-data-file"></span><h3>Data file<a class="headerlink" href="#data-file" title="Permalink to this heading"></a></h3>
<p>A line defining a data file can be written as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>project,dataset,data_type,data_path,args,prefix
project_1,dataset_1,h5ad,/path/to/visium/anndata.h5ad,,
</pre></div>
</div>
<p>Supported values are</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 29%" />
<col style="width: 43%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>data_type</p></th>
<th class="head"><p>data_path</p></th>
<th class="head"><p>args</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">h5ad</span></code></p></td>
<td><p>Path to the <code class="docutils literal notranslate"><span class="pre">h5ad</span></code> file</p></td>
<td><p>JSON-like string with arguments as described in <a class="reference internal" href="#args">args</a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">spaceranger</span></code></p></td>
<td><p>Path to a SpaceRanger output directory</p></td>
<td><p>JSON-like string with arguments as described in <a class="reference internal" href="#args">args</a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">xenium</span></code></p></td>
<td><p>Path to a Xenium output directory</p></td>
<td><p>JSON-like string with arguments as described in <a class="reference internal" href="#args">args</a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">merscope</span></code></p></td>
<td><p>Path to a MERSCOPE output directory</p></td>
<td><p>JSON-like string with arguments as described in <a class="reference internal" href="#args">args</a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">molecules</span></code></p></td>
<td><p>Path to a molecules <code class="docutils literal notranslate"><span class="pre">csv</span></code>/<code class="docutils literal notranslate"><span class="pre">tsv</span></code> file</p></td>
<td><p>JSON-like string with arguments as described in <a class="reference internal" href="#args">args</a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">raw_image</span></code></p></td>
<td><p>Path to the raw <code class="docutils literal notranslate"><span class="pre">tif</span></code> image</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">label_image</span></code></p></td>
<td><p>Path to the raw <code class="docutils literal notranslate"><span class="pre">tif</span></code> image</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">raw_image_data</span></code></p></td>
<td><p>Path to a file or directory containing data from which to generate or pre-process a raw <code class="docutils literal notranslate"><span class="pre">tif</span></code> image.</p>
<p>Possible inputs depend on the supported technology from which the data is obtained,</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">merscope</span></code> requires a path to the output directory containing an <code class="docutils literal notranslate"><span class="pre">images</span></code> directory
where image channels are stored as <code class="docutils literal notranslate"><span class="pre">tif</span></code> files</p></li>
</ul>
</div></blockquote>
</td>
<td><p>JSON-like string with data type-specific key-values.</p>
<p><a class="reference internal" href="#data-parameters-raw-image-data"><span class="std std-ref">See full list</span></a></p>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">label_image_data</span></code></p></td>
<td><p>Path to a file or directory containing data from which to generate a label <code class="docutils literal notranslate"><span class="pre">tif</span></code> image.</p>
<p>Possible inputs depend on the supported technology from which the data is obtained,</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">visium</span></code> requires a path to an <code class="docutils literal notranslate"><span class="pre">h5ad</span></code> file or SpaceRanger output directory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xenium</span></code> requires a path to a Xenium output directory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">merscope</span></code> requires a path to a MERSCOPE output directory</p></li>
</ul>
</div></blockquote>
</td>
<td><p>JSON-like string with data type-specific key-values.</p>
<p><a class="reference internal" href="#data-parameters-label-image-data"><span class="std std-ref">See full list</span></a></p>
</td>
</tr>
</tbody>
</table>
<section id="raw-image-data">
<span id="data-parameters-raw-image-data"></span><h4>raw image data<a class="headerlink" href="#raw-image-data" title="Permalink to this heading"></a></h4>
<p>Supported raw image data types: <code class="docutils literal notranslate"><span class="pre">merscope</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">args</span></code> are defined with a JSON-like string containing the key-values corresponding to the type of data provided
as described below</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 29%" />
<col style="width: 43%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>type</p></th>
<th class="head"><p>key</p></th>
<th class="head"><p>value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>all</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">file_type</span></code>
(required)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">merscope</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">merscope</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">z_index</span></code>
(optional)</p></td>
<td><p>Z index or list of Z indices of which to concatenate their separate channel images into a single <code class="docutils literal notranslate"><span class="pre">tif</span></code> image</p>
<p>Defaults to <code class="docutils literal notranslate"><span class="pre">[0]</span></code></p>
</td>
</tr>
</tbody>
</table>
<p>For example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>project,dataset,data_type,data_path,args,prefix
project_1,dataset_1,raw_image_data,/path/to/merscope/output/,&#39;{&quot;file_type&quot;: &quot;merscope&quot;}&#39;,
project_1,dataset_2,raw_image_data,/path/to/merscope2/output/,&#39;{&quot;file_type&quot;: &quot;merscope&quot;, &quot;z_index&quot;: [0,1]}&#39;,
</pre></div>
</div>
</section>
<section id="label-image-data">
<span id="data-parameters-label-image-data"></span><h4>label image data<a class="headerlink" href="#label-image-data" title="Permalink to this heading"></a></h4>
<p>Supported label image data types: <code class="docutils literal notranslate"><span class="pre">visium</span></code>, <code class="docutils literal notranslate"><span class="pre">xenium</span></code>, <code class="docutils literal notranslate"><span class="pre">merscope</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">args</span></code> are defined with a JSON-like string containing the key-values corresponding to the type of data provided
as described below</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 29%" />
<col style="width: 43%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>type</p></th>
<th class="head"><p>key</p></th>
<th class="head"><p>value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>all</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">file_type</span></code>
(required)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">visium</span></code>, <code class="docutils literal notranslate"><span class="pre">xenium</span></code> or <code class="docutils literal notranslate"><span class="pre">merscope</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>all</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ref_img</span></code>
(optional)</p></td>
<td><p>A reference <code class="docutils literal notranslate"><span class="pre">tif</span></code> image of the size of the desired label image.</p></td>
</tr>
<tr class="row-even"><td><p>all</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">shape</span></code>
(optional)</p></td>
<td><p>Shape of the desired label image as <code class="docutils literal notranslate"><span class="pre">[int,</span> <span class="pre">int]</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">visium</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">obs_subset</span></code>
(optional)</p></td>
<td><p>A tuple containing <code class="docutils literal notranslate"><span class="pre">obs</span></code> column name and value(s) like to subset the Anndata object.
Useful if the the Anndata object contains data of multiple slides.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">visium</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sample_id</span></code>
(optional)</p></td>
<td><p>The name of the sample within the Anndata object.
Otherwise the first one will be used.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">xenium</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">resolution</span></code>
(optional)</p></td>
<td><p>Pixel resolution.</p>
<p>Defaults to <code class="docutils literal notranslate"><span class="pre">0.2125</span></code></p>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">merscope</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">z_index</span></code>
(optional)</p></td>
<td><p>Z index or list of Z indices of label images to generate.</p>
<p>Defaults to <code class="docutils literal notranslate"><span class="pre">[0]</span></code></p>
</td>
</tr>
</tbody>
</table>
<p>For example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>project,dataset,data_type,data_path,args,prefix
project_1,dataset_1,label_image_data,/path/to/visium/anndata.h5ad,&#39;{&quot;file_type&quot;: &quot;visium&quot;, &quot;ref_img&quot;: &quot;/path/to/raw_image.tif&quot;, &quot;sample_id&quot;: &quot;sample_1&quot;}&#39;,
project_1,dataset_2,label_image_data,/path/to/xenium/output/,&#39;{&quot;file_type&quot;: &quot;xenium&quot;, &quot;shape&quot;: [1000,1000]}&#39;,
project_1,dataset_3,label_image_data,/path/to/merscope/output/,&#39;{&quot;file_type&quot;: &quot;merscope&quot;, &quot;ref_img&quot;: &quot;/path/to/raw_image2.tif&quot;}&#39;,
</pre></div>
</div>
</section>
</section>
<section id="dataset-information">
<span id="data-parameters-dataset-info"></span><h3>Dataset information<a class="headerlink" href="#dataset-information" title="Permalink to this heading"></a></h3>
<p>A line defining optional dataset information can be written as follows</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>project,dataset,data_type,data_path,args,prefix
project_1,dataset_1,title,Dataset 1,,
</pre></div>
</div>
<p>Supported values are</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>data_type</p></th>
<th class="head"><p>data_path</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">title</span></code></p></td>
<td><p>Name or title for the final Vitessce config file and visualization.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">description</span></code></p></td>
<td><p>Dataset description</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">url</span></code></p></td>
<td><p>The url to prepend to each converted data file in the output Vitessce config file.
Vitessce will load files from this location.
This may be the final location to which files will be uploaded to and served
or a local one for testing.</p>
<p>Defaults to <code class="docutils literal notranslate"><span class="pre">http://localhost:3000/</span></code></p>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">layout</span></code></p></td>
<td><p>A predefined Vitessce layout to use, it can be either
<code class="docutils literal notranslate"><span class="pre">minimal</span></code>, <code class="docutils literal notranslate"><span class="pre">simple</span></code> or <code class="docutils literal notranslate"><span class="pre">advanced</span></code>.</p>
<p>Overrides <code class="docutils literal notranslate"><span class="pre">layout</span></code> from <a class="reference internal" href="#id2">run parameters</a>.</p>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">custom_layout</span></code></p></td>
<td><p>An optional string that defines a Vitessce layout
following <a class="reference external" href="https://vitessce.github.io/vitessce-python/api_config.html#vitessce.config.VitessceConfig.layout">Vitessce’s View Config API’s layout alternative
syntax</a>.</p>
<p>Overrides <code class="docutils literal notranslate"><span class="pre">custom_layout</span></code> from <a class="reference internal" href="#id2">run parameters</a>.</p>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">vitessce_options</span></code></p></td>
<td><p>(<em>Not recommended</em>) JSON-like string of values as described in <a class="reference internal" href="#vitessce-options">vitessce options</a>.
This will override the <code class="docutils literal notranslate"><span class="pre">vitessce_options</span></code> defined in <a class="reference internal" href="#id2">run parameters</a> for a specific
dataset only. Though, the numerous values needed would result in a lengthy string,
therefore we <strong>strongly recommend</strong> writing another <a class="reference internal" href="#id2">run parameters</a> file instead of
overriding <code class="docutils literal notranslate"><span class="pre">vitessce_options</span></code>.</p></td>
</tr>
</tbody>
</table>
<p>Note no <code class="docutils literal notranslate"><span class="pre">args</span></code> or <code class="docutils literal notranslate"><span class="pre">prefix</span></code> are required for any type of dataset information.</p>
</section>
</section>
<section id="docker">
<span id="setup-docker"></span><h2>Docker<a class="headerlink" href="#docker" title="Permalink to this heading"></a></h2>
<p>Before running the pipeline, build the docker images.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>docker
./build-docker-imgs.sh
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="run.html" class="btn btn-neutral float-right" title="Running" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Haniffa Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>